# MCP Docs Server — техническая документация

## Назначение

MCP Docs Server — локальный MCP-сервер для автоматической загрузки, индексации и поиска по документации. Он предназначен для интеграции с Continue.dev и другими MCP-клиентами.

Сервер:

- загружает документацию из заданных URL
- разбивает её на чанки
- хранит индекс локально
- выполняет полнотекстовый поиск (BM25-подобный)
- собирает релевантный контекст под токенный бюджет

---

## Архитектура

### Основные компоненты

**1. Индексатор**

- Загружает документы (`fetch`)
- Извлекает видимый текст (`jsdom`)
- Делит текст на чанки фиксированного размера
- Дедуплицирует по SHA-256

**2. Хранилище индекса**
Файловое, JSON-based:

- `chunks.json` — чанки документации
- `sources.json` — метаданные источников
- `errors.json` — журнал ошибок

**3. Поисковый движок**

- Токенизация
- BM25-подобный scoring
- Бонусы за заголовки, начало текста и позицию чанка

**4. Контекст-менеджер**

- Подбирает чанки по релевантности
- Учитывает бюджет токенов
- Возвращает готовый контекст для LLM

**5. MCP STDIO сервер**

- JSON-RPC 2.0
- Автоматически вызывается Continue
- Экспортирует инструменты MCP

---

## Структура проекта

```
local-docs-mcp/
├─ index.js                ← ДВИЖОК (бизнес-логика, БЕЗ MCP)
├─ mcp-docs-server.js      ← MCP-обёртка (STDIO, initialize, framing)
├─ docs_sources.json
├─ docs-index/
├─ package.json

```

docs-index/
├─ web/
│ ├─ chunks.json
│ ├─ sources.json
│ └─ errors.json
└─ project/
├─ chunks.json
├─ sources.json
└─ errors.json

                 ┌─────────────┐

docs_sources.json│ WEB │
└──────┬──────┘
│
┌──────▼──────┐
│ IndexEngine │ ← общий код
└──────┬──────┘
│
docs_project.json│ PROJECT │
└─────────────┘

---

## Источники документации

Файл `docs_sources.json`:

```json
{
  "profiles": {
    "node": {
      "seedUrls": ["https://nodejs.org/api/fs.html"],
      "chunk": { "size": 3500, "overlap": 200 }
    }
  }
}
```

- `profiles` — логическое разделение документации
- `seedUrls` — точки входа
- `chunk` — параметры разбиения

---

## MCP Инструменты

| Инструмент      | Назначение                |
| --------------- | ------------------------- |
| `search_chunks` | Поиск релевантных чанков  |
| `build_context` | Сбор контекста под бюджет |
| `get_sources`   | Просмотр источников       |
| `refresh_index` | Перестроение индекса      |
| `preload_docs`  | Принудительная загрузка   |

---

## Поток работы

1. MCP-клиент подключается
2. Вызывает `initialize`
3. Агент автоматически вызывает инструменты
4. Сервер возвращает результаты поиска/контекста

---

## Требования

- Node.js ≥ 20
- ES Modules (`type: module`)
- Локальная файловая система

---

## Ограничения

- Нет векторного поиска
- Нет авто-краулинга ссылок
- JSON-хранилище не масштабируется

---

## Расширения

- Векторный индекс
- SQLite / DuckDB
- Авто-refresh по hash
- Мульти-серверная MCP-шина
